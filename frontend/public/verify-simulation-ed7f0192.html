<!DOCTYPE html>
<html>
<head>
    <title>Verify Simulation ed7f0192</title>
</head>
<body>
    <h1>Verify Simulation ed7f0192</h1>
    <div id="output">Loading...</div>
    
    <script>
        function verifySimulation() {
            const output = document.getElementById('output');
            const targetSimulationId = 'ed7f0192';
            const targetSessionId = 'local_1753381099605_p87dvy82b';
            
            try {
                // Check simulation results
                const simulationResults = JSON.parse(localStorage.getItem('simulation_results') || '[]');
                const targetSimulation = simulationResults.find(sim => 
                    sim.simulation_id === targetSimulationId || 
                    sim.results?.simulation_id === targetSimulationId
                );
                
                output.innerHTML = `
                    <h2>üîç SIMULATION VERIFICATION</h2>
                    <p><strong>Target Simulation ID:</strong> ${targetSimulationId}</p>
                    <p><strong>Related Session ID:</strong> ${targetSessionId}</p>
                `;
                
                if (!targetSimulation) {
                    output.innerHTML += `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h4>‚ùå Simulation Not Found</h4>
                            <p>Simulation ${targetSimulationId} was not found in localStorage.</p>
                            <p><strong>Available Simulations:</strong></p>
                            <ul>
                                ${simulationResults.map(sim => 
                                    `<li>${sim.simulation_id || sim.results?.simulation_id || 'Unknown'} - ${sim.timestamp ? new Date(sim.timestamp).toLocaleString() : 'Unknown time'}</li>`
                                ).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    const businessIdea = targetSimulation.results?.business_context?.business_idea || 
                                       targetSimulation.results?.data?.business_context?.business_idea || 
                                       'Unknown';
                    const targetCustomer = targetSimulation.results?.business_context?.target_customer || 
                                         targetSimulation.results?.data?.business_context?.target_customer || 
                                         'Unknown';
                    const problem = targetSimulation.results?.business_context?.problem || 
                                  targetSimulation.results?.data?.business_context?.problem || 
                                  'Unknown';
                    const interviews = targetSimulation.results?.interviews || 
                                     targetSimulation.results?.data?.interviews || 
                                     [];
                    
                    const isApiService = businessIdea.toLowerCase().includes('api') || 
                                        businessIdea.toLowerCase().includes('legacy') ||
                                        businessIdea.toLowerCase().includes('sales order');
                    
                    output.innerHTML += `
                        <div style="background: ${isApiService ? '#e8f5e8' : '#fff3cd'}; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h4>${isApiService ? '‚úÖ' : '‚ö†Ô∏è'} Simulation Found</h4>
                            <p><strong>Business Idea:</strong> ${businessIdea}</p>
                            <p><strong>Target Customer:</strong> ${targetCustomer}</p>
                            <p><strong>Problem:</strong> ${problem}</p>
                            <p><strong>Interviews:</strong> ${interviews.length}</p>
                            <p><strong>Created:</strong> ${targetSimulation.timestamp ? new Date(targetSimulation.timestamp).toLocaleString() : 'Unknown'}</p>
                            <p><strong>Source:</strong> ${targetSimulation.source || 'Unknown'}</p>
                            
                            ${isApiService ? 
                                '<p style="color: green; font-weight: bold;">üéØ This IS the API service simulation!</p>' : 
                                '<p style="color: orange; font-weight: bold;">‚ö†Ô∏è This is NOT the API service simulation.</p>'
                            }
                        </div>
                    `;
                    
                    if (interviews.length > 0) {
                        output.innerHTML += `
                            <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; margin: 10px 0;">
                                <h4>üìã Interview Summary</h4>
                                <p><strong>Total Interviews:</strong> ${interviews.length}</p>
                                
                                <h5>Stakeholder Breakdown:</h5>
                                <ul>
                        `;
                        
                        const stakeholderCounts = {};
                        interviews.forEach(interview => {
                            const stakeholder = interview.stakeholder_type || 'Unknown';
                            stakeholderCounts[stakeholder] = (stakeholderCounts[stakeholder] || 0) + 1;
                        });
                        
                        Object.entries(stakeholderCounts).forEach(([stakeholder, count]) => {
                            output.innerHTML += `<li><strong>${stakeholder}:</strong> ${count} interviews</li>`;
                        });
                        
                        output.innerHTML += `
                                </ul>
                                <button onclick="showInterviews()" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 5px 0 0;">
                                    Show All Interviews
                                </button>
                                <button onclick="downloadInterviews()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0 0 0;">
                                    Download Interviews
                                </button>
                            </div>
                        `;
                    }
                }
                
                // Also check the related session
                const sessions = JSON.parse(localStorage.getItem('axwise_research_sessions') || '{}');
                const relatedSession = Object.values(sessions).find(s => s.session_id === targetSessionId);
                
                output.innerHTML += `
                    <h3>üìã Related Session Check</h3>
                `;
                
                if (relatedSession) {
                    output.innerHTML += `
                        <div style="border: 1px solid #007bff; padding: 15px; border-radius: 5px; margin: 10px 0; background: #f0f8ff;">
                            <h4>‚úÖ Related Session Found</h4>
                            <p><strong>Session ID:</strong> ${relatedSession.session_id}</p>
                            <p><strong>Business Idea:</strong> ${relatedSession.business_idea || 'None'}</p>
                            <p><strong>Target Customer:</strong> ${relatedSession.target_customer || 'None'}</p>
                            <p><strong>Problem:</strong> ${relatedSession.problem || 'None'}</p>
                            <p><strong>Questions Generated:</strong> ${relatedSession.questions_generated ? 'Yes' : 'No'}</p>
                        </div>
                    `;
                } else {
                    output.innerHTML += `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin: 10px 0;">
                            <h4>‚ùå Related Session Not Found</h4>
                            <p>Session ${targetSessionId} was not found in localStorage.</p>
                        </div>
                    `;
                }
                
                // Add action buttons
                output.innerHTML += `
                    <h3>üîß Actions</h3>
                    <button onclick="window.open('/unified-dashboard/simulation-history', '_blank')" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
                        Open Simulation History
                    </button>
                    <button onclick="window.open('/unified-dashboard/research', '_blank')" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
                        Open Research Page
                    </button>
                    <button onclick="verifySimulation()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">
                        Refresh Check
                    </button>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                output.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        function showInterviews() {
            const simulationResults = JSON.parse(localStorage.getItem('simulation_results') || '[]');
            const targetSimulation = simulationResults.find(sim => 
                sim.simulation_id === 'ed7f0192' || 
                sim.results?.simulation_id === 'ed7f0192'
            );
            
            if (!targetSimulation) {
                alert('Simulation not found');
                return;
            }
            
            const interviews = targetSimulation.results?.interviews || 
                             targetSimulation.results?.data?.interviews || 
                             [];
            
            const popup = window.open('', '_blank', 'width=1200,height=800');
            popup.document.write(`
                <html>
                    <head><title>Interviews: ed7f0192</title></head>
                    <body>
                        <h1>Interviews for Simulation ed7f0192</h1>
                        <p><strong>Total Interviews:</strong> ${interviews.length}</p>
                        <hr>
                        ${interviews.map((interview, i) => `
                            <div style="border: 1px solid #ddd; margin: 20px 0; padding: 15px;">
                                <h3>Interview ${i + 1}</h3>
                                <p><strong>Stakeholder:</strong> ${interview.stakeholder_type || 'Unknown'}</p>
                                <p><strong>Person ID:</strong> ${interview.person_id || interview.persona_id || 'Unknown'}</p>
                                <h4>Responses:</h4>
                                <pre style="white-space: pre-wrap; background: #f5f5f5; padding: 10px; max-height: 400px; overflow-y: auto;">${JSON.stringify(interview.responses || interview.content || interview, null, 2)}</pre>
                            </div>
                        `).join('')}
                    </body>
                </html>
            `);
        }
        
        function downloadInterviews() {
            const simulationResults = JSON.parse(localStorage.getItem('simulation_results') || '[]');
            const targetSimulation = simulationResults.find(sim => 
                sim.simulation_id === 'ed7f0192' || 
                sim.results?.simulation_id === 'ed7f0192'
            );
            
            if (!targetSimulation) {
                alert('Simulation not found');
                return;
            }
            
            const interviews = targetSimulation.results?.interviews || 
                             targetSimulation.results?.data?.interviews || 
                             [];
            const businessIdea = targetSimulation.results?.business_context?.business_idea || 'Unknown Business';
            
            let content = `SIMULATION INTERVIEWS - ed7f0192\n`;
            content += `=====================================\n\n`;
            content += `Business Idea: ${businessIdea}\n`;
            content += `Total Interviews: ${interviews.length}\n`;
            content += `Generated: ${targetSimulation.timestamp ? new Date(targetSimulation.timestamp).toLocaleString() : 'Unknown'}\n\n`;
            
            interviews.forEach((interview, i) => {
                content += `INTERVIEW ${i + 1}\n`;
                content += `================\n`;
                content += `Stakeholder: ${interview.stakeholder_type || 'Unknown'}\n`;
                content += `Person ID: ${interview.person_id || interview.persona_id || 'Unknown'}\n\n`;
                content += `Responses:\n`;
                content += JSON.stringify(interview.responses || interview.content || interview, null, 2);
                content += `\n\n`;
            });
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `simulation-ed7f0192-interviews.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Downloaded interviews for simulation ed7f0192');
        }
        
        // Run verification on page load
        document.addEventListener('DOMContentLoaded', verifySimulation);
        if (document.readyState !== 'loading') {
            verifySimulation();
        }
    </script>
</body>
</html>
