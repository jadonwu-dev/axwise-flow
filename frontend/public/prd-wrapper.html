<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PRD Component</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
    }
    #prd-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
  </style>
  <!-- Add DOMPurify for HTML sanitization -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" 
          integrity="sha512-H+rglffZ6f5gF7UJgvH4Naa+fGCgjrHKMgoFOGmcPTRwR6oILo5R+gtzNrpDp7iMV3udbymBVjkeZGNz1Em4rQ==" 
          crossorigin="anonymous" 
          referrerpolicy="no-referrer"></script>
</head>
<body>
  <div id="prd-container"></div>
  
  <!-- Load the PRD component script -->
  <script src="prd-component.js"></script>
  
  <script>
    // Initialize the PRD component when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Get the result ID from the URL query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const resultId = urlParams.get('resultId');
      
      if (resultId) {
        // Initialize the PRD component with the result ID
        window.initPRD(resultId);
      } else {
        // Show an error message if no result ID is provided
        const container = document.getElementById('prd-container');
        const errorMessage = document.createElement('div');
        errorMessage.style.padding = '20px';
        errorMessage.style.backgroundColor = '#ffebee';
        errorMessage.style.borderRadius = '4px';
        
        const errorTitle = document.createElement('h3');
        errorTitle.style.color = '#c62828';
        errorTitle.textContent = 'Error';
        
        const errorText = document.createElement('p');
        errorText.textContent = 'No result ID provided. Please specify a resultId query parameter.';
        
        errorMessage.appendChild(errorTitle);
        errorMessage.appendChild(errorText);
        container.appendChild(errorMessage);
      }
    });
    
    // Handle messages from the parent window
    window.addEventListener('message', function(event) {
      // Verify the origin of the message for security
      const allowedOrigins = [
        window.location.origin,
        'http://localhost:3000',
        'https://designthinkingagentai.vercel.app'
      ];
      
      if (!allowedOrigins.includes(event.origin)) {
        console.error('Message received from unauthorized origin:', event.origin);
        return;
      }
      
      // Process the message
      const data = event.data;
      
      if (data && data.type === 'initPRD' && data.resultId) {
        window.initPRD(data.resultId);
      }
    });
  </script>
</body>
</html>
